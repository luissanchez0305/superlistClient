<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>New Web Project</title>
		<link href="content/style.css" rel="stylesheet" type="text/css" media="all" />	
        <link rel="stylesheet" href="themes/SuperList.min.css" />
        <link rel="stylesheet" href="content/custom.css" />
		<link rel="stylesheet" href="themes/jquery.mobile.icons.min.css" />
		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile.structure-1.4.5.css" />
		<link href='http://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700,900' rel='stylesheet' type='text/css'>
		<link rel="shortcut icon" href="favicon.ico">
    </head>
    <body>
    <input type="hidden" id="backNavigation" />
	<div data-role="page" data-theme="a" id="signin">
		<div data-role="header" data-position="fixed">
			<h1>Super List</h1>
			<a href="#signup" class="ui-btn ui-shadow ui-corner-all ui-btn-right ui-icon-adduser ui-btn-icon-notext" data-iconpos="notext">Signup</a>
		</div>
		<div data-role="content" data-theme="a"><div data-role="fieldcontain">
			<label for="name">Email:</label>
			<input type="text" name="signinEmail" id="signinEmail" value="lsanchez@esferasoluciones.com"  />
			</div>			
			<div data-role="fieldcontain">
				<label for="name">Contraseña:</label>
				<input type="password" name="signinPassword" id="signinPassword" value="goingup"  />
			</div>	
			<a href="#" id="signinBtn" data-role="button" data-theme="d" data-icon="check" data-inline="true">Ingresar</a>	
			<a href="#signup" data-role="button" data-theme="f" data-inline="true">Registrarse</a>	
			<div id="signinloading" style="width: 100%; display:none;"><img width="50" height="50" src="images/ajax-loader1.gif" /></div>
		</div>
		<div data-role="footer" id="ftrMain" name="ftrMain" data-position="fixed">	
		</div>
	</div>	
	<div data-role="page" data-theme="a" id="signup">
		<div data-role="header" data-position="fixed">
			<h1>Super List</h1>
			<a id="goToSigninBtn" href="#signin" class="ui-btn ui-shadow ui-corner-all ui-btn-left ui-icon-arrow-l ui-btn-icon-notext" data-iconpos="notext">Signin</a>
			<a id="showMenuBtn" href="#right-panel-signup" class="ui-btn ui-shadow ui-corner-all ui-btn-right ui-icon-menu ui-btn-icon-notext menuPanel" data-iconpos="notext">Menu</a>
		</div>
		<div data-role="content" data-theme="a">	
			<fieldset data-role="controlgroup" data-type="horizontal" id="profileControl">
			    <input type="radio" name="radio-choice-h-2" id="radio-choice-h-2a" value="on" checked="checked">
			    <label for="radio-choice-h-2a">Mi info</label>
			    <input type="radio" name="radio-choice-h-2" id="radio-choice-h-2b" value="off">
			    <label for="radio-choice-h-2b">Listas</label>
			</fieldset>
			<div id="profile">
				<form id="signupForm">			
					<div data-role="fieldcontain">
						<input type="text" name="registerName" id="registerName" value="" placeholder="Nombre"  />
					</div>					
					<div data-role="fieldcontain">
						<input type="text" name="registerLastname" id="registerLastname" value="" placeholder="Apellido" />
					</div>					
					<div data-role="fieldcontain">
						<input type="text" name="registerEmail" id="registerEmail" value="" placeholder="email" />
					</div>			
					<div data-role="fieldcontain">
						<input type="password" name="registerPassword" id="registerPassword" value="" placeholder="Password" />
					</div>	
				</form>	
				<a href="#" data-role="button" id="signupBtn" data-theme="f" data-inline="true">Registrarse</a>	
				<a href="#signin" id="signinBackBtn" data-role="button" data-theme="d" data-icon="check" data-inline="true">Ingresar</a>
				<a id="cancelBackBtn" class="cancelBack" data-role="button" data-theme="d" data-icon="back" data-inline="true" style="display:none;">Cancelar</a>
				<div id="registerloading" style="width: 100%; display:none;"><img width="50" height="50" src="images/ajax-loader1.gif" /></div>
			</div>	
			<div id="profileLists">
				<form id="addNewList" style="display:none;">			
					<div data-role="fieldcontain">
						<input type="text" name="newListName" id="newListName" value="" placeholder="Nombre" />
					</div>		
					<a href="#" data-role="button" id="addNewListBtn" data-theme="f" data-inline="true">Guardar</a>
					<a href="#" data-role="button" id="cancelNewListBtn" data-theme="f" data-inline="true">Cancelar</a>
				</form>			
				<form id="addExistingList" style="display:none;">			
					<div data-role="fieldcontain">
						<input type="text" name="listKey" id="listKey" value="" placeholder="Codigo de lista" />
					</div>		
					<a href="#" data-role="button" id="addExistingListBtn" data-theme="f" data-inline="true">Guardar</a>
					<a href="#" data-role="button" id="cancelAddListBtn" data-theme="f" data-inline="true">Cancelar</a>
					<label id="listManageResponseStatus"></label>
				</form>			
				<div id="my_lists"></div>
				<a href="#" data-role="button" id="displayNewListBtn" data-theme="f" data-inline="true">Crear lista</a>
				<a href="#" data-role="button" id="displayAddListBtn" data-theme="f" data-inline="true">Agregar lista</a>
				<a id="cancelListBackBtn" class="cancelBack" data-role="button" data-theme="d" data-icon="back" data-inline="true">Salir</a>
			<!--TODO: BORRAR LISTA DE MI PERFIL. SI ES EL UNICO QUE TIENE ESE LUGAR BORRARLO DEL TODO -->
			</div>
		</div>
		<div data-role="footer" id="ftrMain" name="ftrMain" data-position="fixed">	
		</div>
		<div data-role="panel" data-position="right" id="right-panel-signup">			
			<ul data-role="listview" data-inset="false" data-shadow="false">
				<li data-icon="delete"><a href="#my-header" data-rel="close">&nbsp;</a></li>
				<li data-icon="user"><a href="#" onclick="app.profile();">Perfil</a></li>
				<li data-icon="clipboard"><a href="#categories">Categorias</a></li>
				<li data-icon="grid"><a href="#shoppinglist">Lista de compras</a></li>
				<li data-icon="delete"><a href="#" onclick="app.logout();">Salir</a></li>
			</ul>
		</div>		
	</div>		
	<div data-role="page" data-theme="a" id="index">
		<div data-role="header" data-position="fixed">
			<h1>Super List</h1>
			<a href="#right-panel-index" class="ui-btn ui-shadow ui-corner-all ui-btn-right ui-icon-menu ui-btn-icon-notext menuPanel" data-iconpos="notext">Menu</a>
		</div>
		<div data-role="content" data-theme="a">
			<a id="addCategoriesText" href="#categories" style="float:left;" class="ui-shadow ui-btn ui-corner-all ui-btn-inline">
				Ingrese aquí para agregar sus categorías
			</a>
		<div class="content">
			<div class="clear"> </div>
		</div>
		</div>
		<div data-role="footer" id="ftrMain" name="ftrMain" data-position="fixed">	
			<h4 style="float:right; display: inline-block; margin-right: 10px; font-weight: normal;">Esfera Soluciones &reg;</h4>
		</div>	
		<div data-role="popup" data-overlay-theme="a" id="popupMyLists" data-theme="b">
			<ul data-role="listview" data-inset="true" style="min-width:210px;" class="mylists">
				<li data-role="list-divider">Escoja una de las listas</li>
			</ul>
		</div>		
		<div data-role="panel" data-position="right" id="right-panel-index">			
			<ul data-role="listview" data-inset="false" data-shadow="false">
				<li data-icon="delete"><a href="#my-header" data-rel="close">&nbsp;</a></li>
				<li data-icon="user"><a href="#" onclick="app.profile();">Perfil</a></li>
				<li data-icon="user"><a href="#popupMyLists" data-rel="popup" data-position-to="window" data-transition="slideup" class="listBtn hide">Mis Listas</a></li>
				<li data-icon="clipboard"><a href="#categories">Categorias</a></li>
				<li data-icon="grid"><a href="#shoppinglist">Lista de compras</a></li>
				<li data-icon="delete"><a href="#" onclick="app.logout();">Salir</a></li>
			</ul>
		</div>		
	</div>
	<div data-role="page" data-theme="a" id="categories">
		<div data-role="header" data-position="inline">
			<div class="ui-btn-icon-left ui-icon-arrow-l" onclick="location.href='#index';"></div>
			<h1>Super List - Escoje tus categorias</h1>
		</div>
		<div data-role="content" data-theme="a">
			<fieldset data-role="controlgroup" id="categoriesSet">
			    <legend>Escoja todas las categorias que quieras:</legend>
			    <input type="checkbox" name="categories[]" id="checkbox-v-0">
			    <label for="checkbox-v-0">One</label>
			
			    <input type="checkbox" name="categories[]" id="checkbox-v-1">
			    <label for="checkbox-v-1">Two</label>
			
			    <input type="checkbox" name="categories[]" id="checkbox-v-2">
			    <label for="checkbox-v-2">Three</label>	
			
			    <input type="checkbox" name="categories[]" id="checkbox-v-3">
			    <label for="checkbox-v-3">One</label>
			
			    <input type="checkbox" name="categories[]" id="checkbox-v-4">
			    <label for="checkbox-v-4">Two</label>
			
			    <input type="checkbox" name="categories[]" id="checkbox-v-5">
			    <label for="checkbox-v-5">Three</label>	
			
			    <input type="checkbox" name="categories[]" id="checkbox-v-6">
			    <label for="checkbox-v-6">Two</label>
			
			    <input type="checkbox" name="categories[]" id="checkbox-v-7">
			    <label for="checkbox-v-7">Three</label>	
			</fieldset>	
			<!--<a id="modifyCategoriesButton" style="float:left;" class="ui-shadow ui-btn ui-btn-icon-plus ui-corner-all ui-btn-inline">Guardar</a>
			<a id="cancelCategoriesButton" onclick="navigator.app.backHistory();" style="float:left;" class="ui-shadow ui-btn ui-corner-all ui-btn-inline">Cancelar</a>
			<label id="modifyCategoriesText"></label>	-->
		</div>
	</div>
	
	<div id="products" data-role="page" data-theme="a">
		<div data-role="header" data-position="inline" data-position="fixed">			
			<div class="ui-btn-icon-left ui-icon-arrow-l" onclick="location.href='#index';"></div>
			<h4>Super List - <label id="categoryName">Pan</label></h4>
			<a href="#right-panel-products" class="ui-btn ui-shadow ui-corner-all ui-btn-right ui-icon-menu ui-btn-icon-notext menuPanel" data-iconpos="notext">Menu</a>
		</div>
		<div data-role="content" data-theme="a">
		<div class="content">
			<div class="clear"> </div>
		</div>					
		</div>	
		<div data-role="footer" id="ftrMain" name="ftrMain" data-position="fixed">	
			<h4 style="float:right; display: inline-block; margin-right: 10px; font-weight: normal;">Esfera Soluciones &reg;</h4>
		</div>		
		<div data-role="popup" data-overlay-theme="a" id="popupMyListsProducts" data-theme="b">
			<ul data-role="listview" data-inset="true" style="min-width:210px;" class="mylists">
				<li data-role="list-divider">Escoja una de las listas</li>
			</ul>
		</div>		
		<div data-role="panel" data-position="right" id="right-panel-products">			
			<ul data-role="listview" data-inset="false" data-shadow="false">
				<li data-icon="delete"><a href="#my-header" data-rel="close">&nbsp;</a></li>
				<li data-icon="user"><a href="#" onclick="app.profile();">Perfil</a></li>
				<li data-icon="user"><a class="listBtn hide" href="#popupMyListsProducts" data-rel="popup" data-position-to="window" data-transition="slideup">Mis Listas</a></li>
				<li data-icon="clipboard"><a href="#categories">Categorias</a></li>
				<li data-icon="grid"><a href="#shoppinglist">Lista de compras</a></li>
				<li data-icon="delete"><a href="#" onclick="app.logout();">Salir</a></li>
			</ul>
		</div>
	</div>	
	<div id="product" data-role="page" data-theme="a">
		<input type="hidden" id="productId"/>
		<div data-role="header" data-position="inline" data-position="fixed">
			<div class="ui-btn-icon-left ui-icon-arrow-l" href="#products" onclick="location.href='#products';" data-id="" id="backToProducts"></div>
			<h4>Super List - <label id="productName"></label></h4>
			<a href="#right-panel-product" class="ui-btn ui-shadow ui-corner-all ui-btn-right ui-icon-menu ui-btn-icon-notext menuPanel" data-iconpos="notext">Menu</a>			
		</div>
		<div data-role="content" data-theme="a">
			<div class="content">
				<div class="work">
					<div class="work-top work-product">
						<div class="slider">
							<div class="callbacks_container">
							  <ul class="rslides" id="slider">
								<li>
								  <img id="productImage" style="width: 50%;" src="" alt="">
								  
								</li>
							  </ul>
						  </div>
						</div>
						<h2><a href="#" class="productTitle"></a></h2>
					</div>					
					<div class="work-top work-add">
						<div class="slider">
							<div class="callbacks_container">
							  <ul class="rslides" id="slider">
								<li>
									<button onclick="getPictureFromCamera();">Camera</button> <br>
									<button onclick="getPictureFromGallery();">Gallery</button> <br>
									<input type="hidden" id="imageUploaded" value="false"/>
									<label id="currentState"></label>
									<img id="camera-image" width="250" height="250"/>	
								</li>
							  </ul>
						  </div>
						</div>
						<input type="hidden" id="imageName" name="imageName" />
					</div>
					<div class="work-in">
						<div class="addData">
							<h2>
								<input type="hidden" id="currentAction" name="currentAction" />
								<ul id="productNameAutocomplete" data-role="listview" data-inset="true" data-filter="true" data-filter-placeholder="Producto" data-filter-theme="a"></ul>														
								<input type="hidden" id="addProductName" name="addProductName" placeholder="Nombre"/>
								<!--<ul id="brandNameAutocomplete" data-role="listview" data-inset="true" data-filter="true" data-filter-placeholder="Marca" data-filter-theme="a"></ul>-->
								<input type="hidden" id="addBrandName" name="addBrandName" />
							</h2>
							<div>
								<input type="button" id="addProductButton" value="Guardar"/>
								<input type="button" id="cancelProductButton" value="Cancelar"/>
							</div>							
						</div>
						<div class="info">
							<h3 id="productBrand"></h3>
							<ul class="likes">
								<li>La ultima vez que compró <label class="productTitle"></label></li>
								<li><span><i class="dec"> </i><label id="lastDate"></label></span></li>
								<li><span><i class="comment"> </i><label id="lastQty"></label></span></li>
								<li>
									<div class="valueControllers product">
										<a style="float:left;" class="mngQty ui-shadow ui-btn ui-corner-all ui-icon-minus ui-btn-icon-notext ui-btn-inline" data-id="0">Button</a>
									    <label class="quantity" style="width: 10px; float:left;padding-top: 7px; padding-left: 8px; padding-right: 8px;" id="productQty">0</label>
									    <a style="float:left;" class="mngQty ui-shadow ui-btn ui-corner-all ui-icon-plus ui-btn-icon-notext ui-btn-inline" data-id="0">Button</a>
									</div>		
								</li>
								<a type="button" id="editProduct" action="edit" data-id="" class="ui-btn">Editar</a>
							</ul>
						</div>
					</div>
					<div class="clear"> </div>
				</div>
			</div>	
		</div>	
		<div data-role="popup" data-overlay-theme="a" id="popupMyListsProduct" data-theme="b">
			<ul data-role="listview" data-inset="true" style="min-width:210px;" class="mylists">
				<li data-role="list-divider">Escoja una de las listas</li>
			</ul>
		</div>	
		<div data-role="panel" data-position="right" id="right-panel-product">			
			<ul data-role="listview" data-inset="false" data-shadow="false">
				<li data-icon="delete"><a href="#my-header" data-rel="close">&nbsp;</a></li>
				<li data-icon="user"><a href="#" onclick="app.profile();">Perfil</a></li>
				<li data-icon="user"><a class="listBtn hide" href="#popupMyListsProduct" data-rel="popup" data-position-to="window" data-transition="slideup">Mis Listas</a></li>
				<li data-icon="clipboard"><a href="#categories">Categorias</a></li>
				<li data-icon="grid"><a href="#shoppinglist">Lista de compras</a></li>
				<li data-icon="delete"><a href="#" onclick="app.logout();">Salir</a></li>
			</ul>
		</div>			
	</div>	
	<div data-role="page" data-theme="a" id="shoppinglist">
		<div data-role="header" data-position="inline" data-position="fixed">
			<h1>Mi Super List</h1>
			<a href="#right-panel-list" class="ui-btn ui-shadow ui-corner-all ui-btn-right ui-icon-menu ui-btn-icon-notext" data-iconpos="notext" id="menuPanel">Menu</a>
		</div>		
		<div data-role="content" data-theme="a">	
				<ul data-role="listview" data-inset="true" data-shadow="false" id="items">
				</ul>
		</div>	
		<div data-role="popup" data-overlay-theme="a" id="popupMyListsShoppingList" data-theme="b">
			<ul data-role="listview" data-inset="true" style="min-width:210px;" Class="mylists">
				<li data-role="list-divider">Escoja una de las listas</li>
			</ul>
		</div>	
		<div data-role="panel" data-position="right" id="right-panel-list">			
			<ul data-role="listview" data-inset="false" data-shadow="false">
				<li data-icon="delete"><a href="#my-header" data-rel="close">&nbsp;</a></li>
				<li data-icon="user"><a href="#" onclick="app.profile();">Perfil</a></li>
				<li data-icon="user"><a class="listBtn hide" href="#popupMyListsShoppingList" data-rel="popup" data-position-to="window" data-transition="slideup">Mis Listas</a></li>
				<li data-icon="clipboard"><a href="#categories">Categorias</a></li>
				<li data-icon="plus"><a href="#index">Que te hace falta?</a></li>
				<li data-icon="delete"><a href="#" onclick="app.logout();">Salir</a></li>
			</ul>
		</div>			
		<div data-role="footer" data-theme="a" data-position="fixed">
			<a class="ui-btn ui-shadow ui-corner-all ui-btn-icon-right ui-icon-money" onclick="buyList()">Comprar</a>
			<a href="#buyPopup" data-rel="popup" id="popupSuccess"></a>
		</div>
		<div data-role="popup" id="buyPopup">
			<p>Su compra ha sido realizada</p>
		</div>
	</div>

	<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>	
	<script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.9/jquery.validate.min.js"></script>
    <script type="text/javascript" src="cordova.js"></script>
	<script type="text/javascript" src="config.js"></script>
	<script type="text/javascript" src="app.js"></script>
	<script type="text/javascript">		
        app.initialize();
		$(document).ready(function(){		  
			$('#popupSuccess').hide();
		    $('#profileControl').hide();
		    $('#profileLists').hide();
			
			// desplegar para crear nueva lista
			$('#displayNewListBtn').click(function(){
				$('#displayAddListBtn').hide();
				$('#cancelListBackBtn').hide();
				$('#addNewList').show();
				$('#addExistingList').hide();
				$('#my_lists').hide();
				$(this).hide();
			});
			
			// desplegar para agregar lista
			$('#displayAddListBtn').click(function(){
				$('#displayNewListBtn').hide();
				$('#cancelListBackBtn').hide();
				$('#addExistingList').show();
				$('#addNewList').hide();
				$('#my_lists').hide();
				$(this).hide();				
			});
			
			// esconder crear nueva y agregar lista
			$('#cancelNewListBtn, #cancelAddListBtn').click(function(){
				$('#addExistingList').hide();
				$('#addNewList').hide();
				$('#my_lists').show();
				$('#displayNewListBtn').show();
				$('#displayAddListBtn').show();
				$('#cancelListBackBtn').show();
			});
			
			// boton de crear nueva lista 
			$('#addNewListBtn').click(function(){
				$.ajax({
			            url: baseUrl + "/controllers/usuario_lugar.php",
			            dataType: "json",
			            data: {
			                type: 'adduserlist',
			                uid: window.localStorage["superlist_userid"],
			                n: $('#listName').val()
			            },	
		                success: function ( response ) {
		                	loadLists();
		                },
		                error: function (xhr, status, error){
		                	alert('agregar usuario_lugar: ' + status + ' ' + error);
		                }			
				});
			});
			
			// boton de crear nueva lista 
			$('#addExistingListBtn').click(function(){
				$.ajax({
			            url: baseUrl + "/controllers/usuario_lugar.php",
			            dataType: "json",
			            data: {
			                type: 'addlisttouser',
			                uid: window.localStorage["superlist_userid"],
			                k: $('#listKey').val()
			            },	
		                success: function ( data ) {
		                	if(data.response == 'success')
		                		loadLists();
		                	else if(data.response == 'fail')
		                		$('#listManageResponseStatus').html('El código no concuerda con ninguna lista');
		                	else if(data.response == 'already')
		                		$('#listManageResponseStatus').html('Ya tienes esta lista');
		                	
		                	setTimeout(function(){ $('#listManageResponseStatus').html(''); }, 5000);
		                },
		                error: function (xhr, status, error){
		                	alert('agregar usuario_lugar: ' + status + ' ' + error);
		                }			
				});
			});
			
			// control de la info del usuario y listas en perfil
			$('input[name="radio-choice-h-2"]').click(function(){
				if($('#profile').is(':visible')){
					loadLists();
					$('#profileLists').show();
					$('#profile').hide();					
				}
				else{
					$('#profileLists').hide();
					$('#profile').show();					
				}
			});		
			
			$(document).on('click', '.cancelBack', function(){
	        	$.mobile.changePage("#" + $('#backNavigation').val());				
			});
			
			$(document).on('pageshow', 'div[data-role="page"]', function(){
				if($(this).attr('id') != 'signup')
					$('#backNavigation').val($(this).attr('id'));
			});
			
			// crear el autocomplete de nombre de productos
		    $( "#productNameAutocomplete" ).on("filterablebeforefilter", function ( e, data ) {
		        var $ul = $( this ),
		            $input = $( data.input ),
		            value = $input.val(),
		            html = "";
		        $ul.html( "" );
		        if ( value && value.length > 1 ) {
		            $ul.html( "<li><div class='ui-loader'><span class='ui-icon ui-icon-loading'></span></div></li>" );
		            $ul.listview( "refresh" );
		            
		            $.ajax({
		                url: baseUrl + "/controllers/producto.php",
		                dataType: "json",
		                data: {
		                    q: $input.val(),
		                    type: 'productos'
		                },
		                success: function ( response ) {
			                $.each( response, function ( i, val ) {
			                    html += '<li data-id="'+val.id+'" onclick="chooseProducto(this)">' + val.nombre + '</li>';
			                });
			                $ul.html( html );
			                $ul.listview( "refresh" );
			                $ul.trigger( "updatelayout");
			            },
						error: function(xhr, status, error){
							alert('autocomplete: ' + status + ' ' + error);
						}
		            });
		        }
		    });				
			
			// crear el autocomplete de marcas
		    $( "#brandNameAutocomplete" ).on( "filterablebeforefilter", function ( e, data ) {
		        var $ul = $( this ),
		            $input = $( data.input ),
		            value = $input.val(),
		            html = "";
		        $ul.html( "" );
		        if ( value && value.length > 1 ) {
		            $ul.html( "<li><div class='ui-loader'><span class='ui-icon ui-icon-loading'></span></div></li>" );
		            $ul.listview( "refresh" );
		            
		            $.ajax({
		                url: baseUrl + "/controllers/producto.php",
		                dataType: "json",
		                data: {
		                    q: $input.val(),
		                    type: 'marcas'
		                },
		                success: function ( response ) {
			                $.each( response, function ( i, val ) {
			                    html += '<li data-id="'+val.id+'" onclick="chooseMarca(this)">' + val.nombre + '</li>';
			                });
			                $ul.html( html );
			                $ul.listview( "refresh" );
			                $ul.trigger( "updatelayout");
			            },
						error: function(xhr, status, error){
							alert('autocomplete: ' + status + ' ' + error);
						}
		            });
		        }
		    });	
		    $('#cancelProductButton').click(function(){
		    	if($('#currentAction').val() == 'agregar')
		    		$('#backToProducts').click();
		    	else
		    		$('#products').find('a[data-id="'+$('#productId').val()+'"]').click();
		    });	
		    $('#addProductButton').click(function(){
		    	manageProduct($('#productId').val(),
		    		$('#product').find('input[placeholder="Producto"]').val(), 
		    		$('#product').find('input[placeholder="Marca"]').val(),
		    		$('#addBrandName').val(), 
		    		$('#backToProducts').attr('data-id'), 
		    		$('#camera-image').attr('src'));
		    });	
		    
		    $('#signupBtn').click(function(){
		    	$("#signupForm").submit();
		    });
		    
			$("#signupForm").validate({
			    // Specify the validation rules
			    rules: {
			        registerName: "required",
			        registerLastname: "required",
			        registerEmail: "required",
			        registerPassword: "required"
			    },
			    
			    // Specify the validation error messages
			    messages: {
			    	registerName: "Por favor introduzca un nombre",
			        registerLastname: "Por favor introduzca un apellido",
			        registerEmail: "Por favor introduzca un email",
			        registerPassword: "Por favor introduzca un password"
			    },
			    
			    submitHandler: function(form){
			    	app.signup();
			}
			});
		});
		
		// Agregar producto a la lista
		$('body').on('click', '.ui-icon-minus', function(){
			var $this = $(this);
			var pid = 0;
			if($this.parents('#product').length > 0) {
				pid = $this.parents('#product').find('#productId').val();
			}
			else {
				pid = $this.closest('.content-grid').find('.b-link-stripe').attr('data-id');
			}
			var value = parseInt($this.parent().find('label.quantity').html());
			if(value > 0){
				$this.parent().find('label.quantity').html(value - 1);
				modifyQuantity(pid, value - 1);
			}
			else
				return false;
		});
		
		// Quitar producto de la lista
		$('body').on('click', '.mngQty.ui-icon-plus', function(){
			var $this = $(this);
			var pid = 0;
			if($this.parents('#product').length > 0) {
				pid = $this.parents('#product').find('#productId').val();
			}
			else {
				pid = $this.closest('.content-grid').find('.b-link-stripe').attr('data-id');
			}
			var value = parseInt($this.parent().find('label.quantity').html());
			$this.parent().find('label.quantity').html(value + 1);
			modifyQuantity(pid, value + 1);
		});
		
		$('body').on('change', 'input[id^="checkbox-v"]', function(){
			var $this = $(this);
			if($this.is(':checked') && $this.prev().hasClass('ui-checkbox-off'))
				$this.prev().removeClass('ui-checkbox-off').addClass('ui-checkbox-on');
			else if(!$this.is(':checked') && $this.prev().hasClass('ui-checkbox-on'))
				$this.prev().removeClass('ui-checkbox-on').addClass('ui-checkbox-off');
			
			modifyCategories($this.is(':checked'), $this.val());
		});
		
		// Navegador maestro
		$('body').on("click", 'a, #backToProducts, #editProduct', function() {
			var $this = $(this);
			var view = $this.attr('href') ? $this.attr('href').replace('#','') : $this.attr('action') ? $this.attr('action') : '';
			if(view == 'products'){
				var _lid = window.localStorage["superlist_listid"];
				if(typeof _lid === 'undefined' || _lid.length == 0){					
					$.mobile.activePage.find('.listBtn').click();
				}
				else {
					$('#categoryName').html($this.find('.categoryName').html());
					$('#backToProducts').attr('data-id', $this.attr('data-id'));
					loadProducts(_lid);
				}					
			}
			else if(view == 'product' || view == 'edit'){
				$('#productId').val($this.attr('data-id'));
				if($this.attr('data-id') != '0' && view != 'edit'){
					$('#editProduct').attr('data-id', $this.attr('data-id'));
					$('#productName, .productTitle').html($this.next().find('label')[0].innerHTML);
    				$('#currentAction').val('desplegar');
				}
				else{
					$('#productName, .productTitle').html('Agrega un producto');
    				$('#currentAction').val('agregar');   
					$('#productId').val('0'); 				
					if($this.attr('data-id') != '0' && view == 'edit'){
						$('#productId').val($this.attr('data-id'));
    					$('#currentAction').val('editar');
					}    
				}	
				loadProduct(window.localStorage["superlist_listid"]);
			}
			else if(view == 'shoppinglist'){
				loadShoppingList($('#items'));
			}
			else if(view == 'categories'){
				$.ajax({
					url: baseUrl + '/controllers/categoria.php',
					data: { id: window.localStorage["superlist_userid"], type: 'categories' },
					type: 'get',
					dataType: 'json',
					success: function(data){			
						var count = data.length;
						$.each(data, function(i, categoria){
							$checkbox = $('#checkbox-v-' + i);
							if(categoria.usuarioid > 0){
								$checkbox.prev().removeClass('ui-checkbox-off').addClass('ui-checkbox-on');
								$checkbox.attr('checked', 'checked');
							}
							else{
								$checkbox.prev().removeClass('ui-checkbox-on').addClass('ui-checkbox-off');
								$checkbox.removeAttr('checked');								
							}
							$checkbox.val(categoria.id);
							$checkbox.prev().html(categoria.nombre);
						});			
					},
					error: function(xhr, status, error){
						alert('categories: '+ status + ' ' + error);
					}
				});
			}
			else if(view == 'popupMyLists' || view == 'popupMyListsProducts' || view == 'popupMyListsProduct' || view == 'popupMyListsShoppingList'){
				getActivatedLists(function(data){
					$ul = $('#'+view+' .mylists');
			        $ul.html( '<li data-role="list-divider">Escoja una de las listas</li>' );
			        $ul.listview( "refresh" );
			           
					var html = '';
					$('.listItem').remove();
					$.each(data, function(i, lista){
						activeList = window.localStorage["superlist_listid"];
						html += '<li class="listItem"><a href="#" onclick="chooseList(\''+view+'\','+lista.id+',\''+lista.nombre+'\')" class="ui-btn '+ (activeList == lista.id ? 'ui-icon-carat-l ui-btn-icon-right' : '') + '">'+lista.nombre+'</a></li>';		
					});
					$ul.append(html);
				    $ul.listview( "refresh" );
				    $ul.trigger( "updatelayout");						
				});			
			}
		});
	</script>
    </body>
</html>
