<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>New Web Project</title>
		<link href="content/style.css" rel="stylesheet" type="text/css" media="all" />	
        <link rel="stylesheet" href="themes/SuperList.min.css" />
		<link rel="stylesheet" href="themes/jquery.mobile.icons.min.css" />
		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile.structure-1.4.5.css" />
		<link href='http://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700,900' rel='stylesheet' type='text/css'>
		<link rel="shortcut icon" href="favicon.ico">
		<style>
			.hide{
				display:none;
			}
			.menuPanel{
				border-color: transparent;
			}
			.ui-li-static.ui-collapsible > .ui-collapsible-heading {
		        margin: 0;
		    }
		
		    .ui-li-static.ui-collapsible {
		        padding: 0;
		    }
		
		    .ui-li-static.ui-collapsible > .ui-collapsible-heading > .ui-btn {
		        border-top-width: 0;
		    }
		
		    .ui-li-static.ui-collapsible > .ui-collapsible-heading.ui-collapsible-heading-collapsed > .ui-btn,
		    .ui-li-static.ui-collapsible > .ui-collapsible-content {
		        border-bottom-width: 0;
		    }
		    @media ( min-width: 35em ) {

				/* wrap on wide viewports once open */
			
				.ui-panel-page-content-open.ui-panel-page-content-position-left {
					margin-right: 17em;
				}
				.ui-panel-page-content-open.ui-panel-page-content-position-right {
					margin-left: 17em;
				}
				.ui-panel-page-content-open {
					width: auto;
				}
			
				/* disable "dismiss" on wide viewports */
				.ui-panel-dismiss {
					display: none;
				}
			
				/* same as the above but for panels with display mode "push" only */
			
				.ui-panel-page-content-open.ui-panel-page-content-position-left.ui-panel-page-content-display-push {
					margin-right: 17em;
				}
				.ui-panel-page-content-open.ui-panel-page-content-position-right.ui-panel-page-content-display-push {
					margin-left: 17em;
				}
				.ui-panel-page-content-open.ui-panel-page-content-display-push {
					width: auto;
				}
			
				.ui-panel-dismiss-display-push {
					display: none;
				}
			}
			#items {
				width: 100%;
			}
			#items > li p.header{
				font-size: 220%;
				font-weight: bold;
			}
			#items > li p.quantity{
				font-size: 140%;
				font-weight: 30px;
			}
			#items > li p.status{
				font-size: 200%;
				font-weight: bold;
			}
			#items > li p.status.red{
				color: #f00;
			}
			#items > li p.status.green{
				color: #0f0;
			}
			/* 16px 41px */
			#index .ui-header {
			  height: 41px;   
			  padding: 0;
			}
			#index .ui-header h1 {
			  font-size: 2em;   
			  padding: 0;
			}
			.ui-icon-money:after {
				background-image: url('images/mobile_pay-512.png');
				/* Make your icon fit */
				background-size: 18px 18px;
			}
			.ui-icon-menu:after {
				background-image: url('images/menu_icon2.png');
				/* Make your icon fit */
				background-size: 18px 18px;
			}
			.ui-icon-reload:after {
				background-image: url('images/reload.png');
				/* Make your icon fit */
				background-size: 18px 18px;
			}

			.ui-content {
    			padding: 0px;
			}
			.categoryName{
				position: relative;
				top: -45px;
				height: 45px;
				background-color: rgba(255, 255, 255, 0.8);
				text-align: center;
				padding-top: 9px;
			}
			.valueControllers{
				color: #0f0f0f; 
				position: relative; 
				top: -50px; 
				height: 45px; 
				background-color:rgba(255, 255, 255, 0.8);
			}
			.valueControllers.product{				
				color: #0f0f0f; 
				background-color:rgba(255, 255, 255, 0.8);
				top: 0px; 
				margin-left: 50px;
				padding-top: 10px;
			}
			.ui-mobile label {
				display: inline;
			}
			.ui-icon-menu2:after {
				background-image: url('images/menu_icons.png') 0 -484px;
				width: 66px;
				height: 58px;
				/* Make your icon fit */
				background-size: 18px 18px;
			}		
			.ui-filter-inset {
			    margin-top: 0;
			}	
		</style>
    </head>
    <body>
	<div data-role="page" data-theme="a" id="index">
		<div data-role="header" data-position="fixed">
			<h1>Super List</h1>
			<a href="#right-panel-index" class="ui-btn ui-shadow ui-corner-all ui-btn-right ui-icon-menu ui-btn-icon-notext menuPanel" data-iconpos="notext">Menu</a>
		</div>
		<div data-role="content" data-theme="a">
		<div class="content">
			<div class="clear"> </div>
		</div>
		</div>
		<div data-role="footer" id="ftrMain" name="ftrMain" data-position="fixed">	
			<h4 style="float:right; display: inline-block; margin-right: 10px; font-weight: normal;">Esfera Soluciones &reg;</h4>
		</div>	
		<div data-role="panel" data-position="right" id="right-panel-index">			
			<ul data-role="listview" data-inset="false" data-shadow="false">
				<li data-icon="delete"><a href="#my-header" data-rel="close">&nbsp;</a></li>
				<li data-icon="user"><a href="#">Perfil</a></li>
				<li data-icon="grid"><a href="#list">Lista de compras</a></li>
			</ul>
		</div>
	</div>
	<div id="products" data-role="page" data-theme="a">
		<div data-role="header" data-position="inline" data-position="fixed">			
			<div class="ui-btn-icon-left ui-icon-arrow-l" onclick="location.href='#index';"></div>
			<h4>Super List - <label id="categoryName">Pan</label></h4>
			<a href="#right-panel-products" class="ui-btn ui-shadow ui-corner-all ui-btn-right ui-icon-menu ui-btn-icon-notext menuPanel" data-iconpos="notext">Menu</a>
		</div>
		<div data-role="content" data-theme="a">
		<div class="content">
			<div class="clear"> </div>
		</div>					
		</div>	
		<div data-role="footer" id="ftrMain" name="ftrMain" data-position="fixed">	
			<h4 style="float:right; display: inline-block; margin-right: 10px; font-weight: normal;">Esfera Soluciones &reg;</h4>
		</div>			
		<div data-role="panel" data-position="right" id="right-panel-products">			
			<ul data-role="listview" data-inset="false" data-shadow="false">
				<li data-icon="delete"><a href="#my-header" data-rel="close">&nbsp;</a></li>
				<li data-icon="user"><a href="#">Perfil</a></li>
				<li data-icon="grid"><a href="#list">Lista de compras</a></li>
			</ul>
		</div>
	</div>	
	<div id="product" data-role="page" data-theme="a">
		<input type="hidden" id="productId"/>
		<div data-role="header" data-position="inline" data-position="fixed">
			<div class="ui-btn-icon-left ui-icon-arrow-l" href="#products" onclick="location.href='#products';" data-id="" id="backToProducts"></div>
			<h4>Super List - <label id="productName"></label></h4>
			<a href="#right-panel-product" class="ui-btn ui-shadow ui-corner-all ui-btn-right ui-icon-menu ui-btn-icon-notext menuPanel" data-iconpos="notext">Menu</a>			
		</div>
		<div data-role="content" data-theme="a">
			<div class="content">
				<div class="work">
					<div class="work-top work-product">
						<div class="slider">
							<div class="callbacks_container">
							  <ul class="rslides" id="slider">
								<li>
								  <img id="productImage" style="width: 50%;" src="" alt="">
								  
								</li>
							  </ul>
						  </div>
						</div>
						<h2><a href="#" class="productTitle"></a></h2>
					</div>					
					<div class="work-top work-add">
						<div class="slider">
							<div class="callbacks_container">
							  <ul class="rslides" id="slider">
								<li>
									<button onclick="getPictureFromCamera();">Camera</button> <br>
									<button onclick="getPictureFromGallery();">Gallery</button> <br>	
									<label id="currentState"></label>
									<img id="camera-image" width="250" height="250"/>	
								</li>
							  </ul>
						  </div>
						</div>
						<input type="hidden" id="imageName" name="imageName" />
						<h2>
							<input type="text" id="addProductName" name="addProductName" placeholder="Nombre"/>
							<ul id="brandNameAutocomplete" data-role="listview" data-inset="true" data-filter="true" data-filter-placeholder="Marca" data-filter-theme="a"></ul>
							<input type="hidden" id="addBrandName" name="addBrandName" />
						</h2>
						<div>
							<input type="button" id="addProductButton" value="Agregar"/>
							<input type="button" id="cancelProductButton" value="Cancelar"/>
						</div>
					</div>
					<div class="work-in">
						<div class="info">
						<h3 id="productBrand"></h3>
							<ul class="likes">
								<li>La ultima vez que compró <label class="productTitle"></label></li>
								<li><span><i class="dec"> </i><label id="lastDate"></label></span></li>
								<li><span><i class="comment"> </i><label id="lastQty"></label></span></li>
								<li>
									<div class="valueControllers product">
										<a style="float:left;" class="mngQty ui-shadow ui-btn ui-corner-all ui-icon-minus ui-btn-icon-notext ui-btn-inline" data-id="0">Button</a>
									    <label class="quantity" style="width: 10px; float:left;padding-top: 7px; padding-left: 8px; padding-right: 8px;" id="productQty">0</label>
									    <a style="float:left;" class="mngQty ui-shadow ui-btn ui-corner-all ui-icon-plus ui-btn-icon-notext ui-btn-inline" data-id="0">Button</a>
									</div>		
								</li>
							</ul>
						</div>
					</div>
					<div class="clear"> </div>
				</div>
			</div>	
		</div>	
		<div data-role="panel" data-position="right" id="right-panel-product">			
			<ul data-role="listview" data-inset="false" data-shadow="false">
				<li data-icon="delete"><a href="#my-header" data-rel="close">&nbsp;</a></li>
				<li data-icon="user"><a href="#">Perfil</a></li>
				<li data-icon="grid"><a href="#list">Lista de compras</a></li>
			</ul>
		</div>			
	</div>	
	<div data-role="page" data-theme="a" id="list">
		<div data-role="header" data-position="inline" data-position="fixed">
			<h1>Mi Super List</h1>
			<a href="#right-panel-list" class="ui-btn ui-shadow ui-corner-all ui-btn-right ui-icon-menu ui-btn-icon-notext" data-iconpos="notext" id="menuPanel">Menu</a>
		</div>		
		<div data-role="content" data-theme="a">	
				<ul data-role="listview" data-inset="true" data-shadow="false" id="items">
				</ul>
		</div>	
		<div data-role="panel" data-position="right" id="right-panel-list">			
			<ul data-role="listview" data-inset="false" data-shadow="false">
				<li data-icon="delete"><a href="#my-header" data-rel="close">&nbsp;</a></li>
				<li data-icon="user"><a href="#">Perfil</a></li>
				<li data-icon="plus"><a href="#index">Que te hace falta?</a></li>
			</ul>
		</div>			
		<div data-role="footer" data-theme="a" data-position="fixed">
			<a class="ui-btn ui-shadow ui-corner-all ui-btn-icon-right ui-icon-money" onclick="buyList()">Comprar</a>
			<a href="#buyPopup" data-rel="popup" id="popupSuccess"></a>
		</div>
		<div data-role="popup" id="buyPopup">
			<p>Su compra ha sido realizada</p>
		</div>
	</div>
	<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>	
    <script type="text/javascript" src="cordova.js"></script>
	<script src="app.js"></script>
	<script type="text/javascript">		
        app.initialize();
		$(document).ready(function(){
			$('#popupSuccess').hide();
			loadList($('#items'));
			$.ajax({
				url: baseUrl + '/controllers/index.php',
				dataType: "json",
				success: function(data){
					$('#index .content .content-grid').remove();
					$.each(data, function(i, categoria){
						$('#index .content').append(
							'<div class="content-grid">'+
								'<a href="#products" class="b-link-stripe b-animate-go  thickbox" data-id="'+categoria.id+'">'+
									'<img  src="'+baseUrl+'/uploads/'+categoria.imagen+'" />'+
									'<div class="categoryName">'+categoria.nombre+'</div>'+
								'</a>'+
							'</div>'
						);
					});
				},
				error: function(xhr, status, error){
					alert('categorias: ' + status + ' ' + error);
				}
			});
			
			// crear el autocomplete de marcas
		    $( "#brandNameAutocomplete" ).on( "filterablebeforefilter", function ( e, data ) {
		        var $ul = $( this ),
		            $input = $( data.input ),
		            value = $input.val(),
		            html = "";
		        $ul.html( "" );
		        if ( value && value.length > 1 ) {
		            $ul.html( "<li><div class='ui-loader'><span class='ui-icon ui-icon-loading'></span></div></li>" );
		            $ul.listview( "refresh" );
		            $.ajax({
		                url: baseUrl + "/controllers/producto.php",
		                dataType: "json",
		                data: {
		                    q: $input.val(),
		                    type: 'marcas'
		                },
		                success: function ( response ) {
			                $.each( response, function ( i, val ) {
			                    html += '<li data-id="'+val.id+'" onclick="chooseMarca(this)">' + val.nombre + '</li>';
			                });
			                $ul.html( html );
			                $ul.listview( "refresh" );
			                $ul.trigger( "updatelayout");
			            },
						error: function(xhr, status, error){
							alert('autocomplete: ' + status + ' ' + error);
						}
		            });
		        }
		    });	
		    $('#cancelProductButton').click(function(){
		    	$('#backToProducts').click();
		    });	
		    $('#addProductButton').click(function(){
		    	addProduct($('#addProductName').val(), 
		    		$('#addBrandName').val(), 
		    		$('#backToProducts').attr('data-id'), 
		    		$('#camera-image').attr('src'));
		    });	
		});
		
		// Agregar producto a la lista
		$('body').on('click', '.ui-icon-minus', function(){
			var $this = $(this);
			var pid = 0;
			if($this.parents('#product').length > 0) {
				pid = $this.parents('#product').find('#productId').val();
			}
			else {
				pid = $this.closest('.content-grid').find('.b-link-stripe').attr('data-id');
			}
			var value = parseInt($this.parent().find('label.quantity').html());
			if(value > 0){
				$this.parent().find('label.quantity').html(value - 1);
				modifyQuantity(pid, value - 1);
			}
			else
				return false;
		});
		
		// Quitar producto de la lista
		$('body').on('click', '.mngQty.ui-icon-plus', function(){
			var $this = $(this);
			var pid = 0;
			if($this.parents('#product').length > 0) {
				pid = $this.parents('#product').find('#productId').val();
			}
			else {
				pid = $this.closest('.content-grid').find('.b-link-stripe').attr('data-id');
			}
			var value = parseInt($this.parent().find('label.quantity').html());
			$this.parent().find('label.quantity').html(value + 1);
			modifyQuantity(pid, value + 1);
		});
		
		// Navegador maestro
		$('body').on("click", 'a, #backToProducts', function() {
			var $this = $(this);
			var view = $this.attr('href') ? $this.attr('href').replace('#','') : '';
			if(view == 'products'){
				$('#categoryName').html($this.find('.categoryName').html());
				$('#backToProducts').attr('data-id', $this.attr('data-id'));
				$.ajax({
					url: baseUrl + '/controllers/productos.php',
					data: { id: $this.attr('data-id'), lid: lugar, type: 'productos' },
					type: 'get',
					dataType: 'json',
					success: function(data){
						$('#products .content .content-grid').remove();
						var count = data.length;
						if(count > 0)
							$.each(data, function(i, producto){
								$('#products .content').append(
									'<div class="content-grid">'+
										'<a href="#product" class="b-link-stripe b-animate-go thickbox" data-id="'+producto.id+'">'+
											'<img  src="'+baseUrl+'/uploads/'+producto.imagen+'" style="width:74%;height:74%; display:block; margin: auto;"/>'+
										'</a>'+
										'<div class="valueControllers">'+
											'<label style="padding-top:11px; padding-left: 5px; float:left; font-weight: bold; color: #3388cc;">'+producto.nombre + ' - ' + producto.marcaNombre +'</label>'+
					    					'<a style="float:right;" class="mngQty ui-shadow ui-btn ui-corner-all ui-icon-plus ui-btn-icon-notext ui-btn-inline">Button</a>'+
					    					'<label class="quantity" style="width: 10px; float:right;	padding-top: 15px; padding-right: 8px;">'+producto.cantidad+'</label>'+
					    					'<a style="float:right;" class="mngQty ui-shadow ui-btn ui-corner-all ui-icon-minus ui-btn-icon-notext ui-btn-inline">Button</a>'+
										'</div>'+
									'</div>'
								);							
								if(!--count){
									appendAddProduct($('#products .content'));																
								}
							});
						else
							appendAddProduct($('#products .content'));								
					},
					error: function(xhr, status, error){
						alert('productos: ' + status + ' ' + error);
					}
				});
			}
			else if(view == 'product'){
				if($this.attr('data-id') != '0'){
					$('#productName, .productTitle').html($this.next().find('label')[0].innerHTML);
					$('#product .work-top.work-product').show();
					$('#product .work-top.work-add').hide();
					$('#product .work-in').show();
					$.ajax({
						url: baseUrl + '/controllers/productos.php',
						data: { id: $this.attr('data-id'), lid: lugar, type: 'producto' },
						type: 'get',
						dataType: 'json',
						success: function(data){
							$('#productId').val(data.id);
							$('#productImage').attr('src', '');
							$('#productBrand').html('');
							$('#lastDate').html('');
							$('#lastQty').html('');
							$('#productQty').html('');
							
							$('#productImage').attr('src', baseUrl+'/uploads/' + data.imagen);
							$('#productBrand').html(data.marca);
							if(data.ultimaFecha){
								$('#lastDate').html('Fue el ' + data.ultimaFecha);
								$('#lastQty').html('Compró ' + data.ultimaCantidad + ' unidad' + (data.ultimaCantidad > 1 ? 'es' : ''));
							}
							else{					
								$('#lastDate').html('Nunca lo ha comprado antes');	
								$('#lastQty').html('');
							}
							
							$('#productQty').html(data.cantidad);
						},
						error: function(xhr, status, error){
							alert('producto: ' + status + ' ' + error);
						}
						
					});
				}
				else{	
					$('#productName, .productTitle').html('Agrega un producto');				
					$('#product .work-top.work-product').hide();
					$('#product .work-top.work-add').show();
					$('#product .work-in').hide();					
        			$('#camera-image').attr('src','');
				}
					
			}
			else if(view == 'list'){
				loadList();
			}
		});
	</script>
    </body>
</html>
